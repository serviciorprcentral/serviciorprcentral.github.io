<!DOCTYPE html>
<html lang="en">
<head>
  <title>RPR Centro de Servicio</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  <script src="./resources/html2canvas.min.js"></script>
  <script src="./resources/qrcode.min.js"></script>
</head>
<body>

<nav class="navbar navbar-inverse">
  <div class="container-fluid">
    <div class="navbar-header">
      <a class="navbar-brand" href="https://serviciorprcentral.github.io">
        Rainbow PR
      </a>
    </div>
    <ul class="nav navbar-nav">
      <li class="active"><a>QR-Code Generator</a></li>
    </ul>
  </div>
</nav>

<div class="container">
  <h1>QR-Code ID Generator</h1>
  <div id="app">
    <div class="row">
      <div class="col-xs-12">
        <form class="form-horizontal">
         <div class="form-group form-group-lg" :class="(urlValidation == true) ? 'has-success' : (urlValidation == false) ? 'has-error' : ''">
          <div class="col-xs-12">
            <div class="input-group">
              <span class="input-group-addon">URL</span>
              <input class="form-control" v-model.trim="url" class="form-control" type="text" id="link" placeholder="https://rainbowsystem.com">
                <span v-if="urlValidation == true" class="glyphicon glyphicon-ok form-control-feedback" aria-hidden="true"></span>
                <span v-else-if="urlValidation == false" class="glyphicon glyphicon-remove form-control-feedback" aria-hidden="true"></span>
                <span v-else aria-hidden="true"></span>
            </div>
          </div>
        </div>
      </form>
      </div>
    </div>
    <div class="row text-center">
      <div class="col-xs-12">
        <button @click="generate" class="btn-lg" :class="urlValidation == true ? 'btn-success' : 'btn-secondary' " :disabled="!urlValidation">Generate</button>
      </div>
    </div>

    <div class="modal fade" id="qrCodeModal" role="dialog">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h3 class="modal-title">QR Code Generated!</h3>
          </div>
          <div class="modal-body">
            <div class="row">
              <div class="col-xs-12">
                <center>
                  <div id="qrcode"></div>
                </center>
              </div>
            </div>
            <div class="row text-center">
              <div class="col-xs-12">
                <button @click="download" class="btn-primary btn-lg">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-download" viewBox="0 0 16 16">
  <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5"/>
  <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"/>
</svg>
                 Download
                </button>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn-danger btn-lg" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script type="importmap">
  {
    "imports": {
      "vue": "https://unpkg.com/vue@3/dist/vue.esm-browser.js"
    }
  }
</script>
<script type="module">
  import { createApp } from 'vue'

  createApp({
    data() {
      return {
        url: '',
        qrCodeGenerated: false,
        qrCode: null
      }
    },
    computed : {
      urlValidation() {
      return this.url.trim().length === 0 ? null : /[(http(s)?):\/\/(www\.)?a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/.test(this.url.trim())
      }
    },
    methods: {
      generate() {
        if (this.urlValidation) {
          $("#qrCodeModal").modal()
          if (!this.qrCodeGenerated) {
            this.qrCode = new QRCode(document.getElementById("qrcode"), this.url);
            this.qrCodeGenerated = true
          }
          else {
            this.qrCode.clear()
            this.qrCode.makeCode(this.url)
          }
        }
      },
      download() {
      var container = document.getElementById("qrcode");
         html2canvas(container, { allowTaint: true }).then(function (canvas) {
       
         var link = document.createElement("a");
         document.body.appendChild(link);
         link.download = "qr-code.jpg";
         link.href = canvas.toDataURL();
         link.target = '_blank';
         link.click();
       }); 
      }
    } 
  }).mount('#app')
</script>
</div>
</body>
